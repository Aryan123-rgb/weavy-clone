[{"filePath":"C:\\Users\\91895\\Desktop\\projects\\weavy-clone\\src\\components\\workflow\\nodes\\CropImageNode.tsx","messages":[{"ruleId":"@typescript-eslint/no-unnecessary-type-assertion","severity":2,"message":"This assertion is unnecessary since it does not change the type of the expression.","line":63,"column":19,"nodeType":"TSAsExpression","messageId":"unnecessaryAssertion","endLine":63,"endColumn":74,"fix":{"range":[1884,1923],"text":""}}],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":236,"column":15,"nodeType":"JSXOpeningElement","endLine":240,"endColumn":17,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport {\r\n  Handle,\r\n  Position,\r\n  useReactFlow,\r\n  useHandleConnections,\r\n} from \"@xyflow/react\";\r\nimport React, { useState } from \"react\";\r\nimport type { Node, NodeProps, Connection, Edge } from \"@xyflow/react\";\r\nimport { Crop as CropIcon } from \"lucide-react\";\r\nimport { cn } from \"~/lib/utils\";\r\nimport { useFlowStore } from \"~/store/flowStore\";\r\nimport { toast } from \"sonner\";\r\n\r\n// Define the data type for our node\r\ntype CropImageNodeData = {\r\n  label?: string;\r\n  imageUrl?: string; // The output url (Base64)\r\n};\r\n\r\ntype MyNode = Node<CropImageNodeData>;\r\n\r\nexport function CropImageNode({ data, selected, id }: NodeProps<MyNode>) {\r\n  const { updateNodeData, nodeData } = useFlowStore();\r\n  const { getEdges, getNodes } = useReactFlow();\r\n\r\n  // Inputs for crop percentages\r\n  const [cropParams, setCropParams] = useState({\r\n    x: 0,\r\n    y: 0,\r\n    width: 100,\r\n    height: 100,\r\n  });\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n\r\n  // Input connection tracking\r\n  const connections = useHandleConnections({ type: \"target\", id: \"image\" });\r\n\r\n  // Helper to get input image URL from connection\r\n  const getInputImage = () => {\r\n    const edges = getEdges();\r\n    const nodes = getNodes();\r\n\r\n    // Find edge connected to our 'image' handle\r\n    const edge = edges.find(\r\n      (e) => e.target === id && e.targetHandle === \"image\",\r\n    );\r\n    if (!edge) return null;\r\n\r\n    // Try store first (live data)\r\n    if (nodeData[edge.source]) {\r\n      const sourceData = nodeData[edge.source] as Record<string, unknown>;\r\n      // Support imageUrl (standard) or image (legacy)\r\n      const img = (sourceData.imageUrl ?? sourceData.image) as\r\n        | string\r\n        | undefined;\r\n      return img;\r\n    }\r\n\r\n    // Fallback to node data\r\n    const sourceNode = nodes.find((n) => n.id === edge.source);\r\n    const sData = sourceNode?.data as Record<string, unknown> | undefined;\r\n    const sImg = (sData?.imageUrl ?? sData?.image) as string | undefined;\r\n    return sImg;\r\n  };\r\n\r\n  const validateInput = (connection: Connection | Edge) => {\r\n    // connection.sourceHandle is the ID of the handle on the source node\r\n    const sourceHandleId = connection.sourceHandle;\r\n\r\n    // Only allow connection if the source handle is explicitly an image output\r\n    // We assume nodes outputting images use id=\"image\"\r\n    if (sourceHandleId === \"image\") return true;\r\n    return false;\r\n  };\r\n\r\n  const handleCrop = async () => {\r\n    const inputUrl = getInputImage();\r\n\r\n    if (!inputUrl || typeof inputUrl !== \"string\") {\r\n      toast.error(\"No input image detected\", {\r\n        description:\r\n          \"Please connect an image output (like Upload Image) to this node.\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (!inputUrl.startsWith(\"data:image/\")) {\r\n      toast.error(\"Invalid Input Format\", {\r\n        description: \"The connected node must provide a Base64 Data URL.\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setIsProcessing(true);\r\n    try {\r\n      const { cropImage } = await import(\"~/app/actions\");\r\n\r\n      toast.promise(cropImage(inputUrl, cropParams), {\r\n        loading: \"Cropping image...\",\r\n        success: (result) => {\r\n          // Update local data and global store with result\r\n          updateNodeData(id, { imageUrl: result.url });\r\n          return \"Image Cropped Successfully\";\r\n        },\r\n        error: (err) => {\r\n          console.error(\"Crop error\", err);\r\n          return \"Crop Failed\";\r\n        },\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Action import failed\", error);\r\n      toast.error(\"Failed to start crop process\");\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  };\r\n\r\n  const handleParamChange = (field: keyof typeof cropParams, value: string) => {\r\n    const num = parseFloat(value);\r\n    if (!isNaN(num)) {\r\n      setCropParams((prev) => ({ ...prev, [field]: num }));\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={cn(\r\n        \"group relative flex w-80 flex-col rounded-xl border-2 bg-[#1A1A1A] text-white shadow-2xl transition-all\",\r\n        selected\r\n          ? \"border-[#E0FC00] shadow-[#E0FC00]/20\"\r\n          : \"border-white/10 hover:border-white/20\",\r\n      )}\r\n    >\r\n      {/* Header */}\r\n      <div className=\"flex h-10 items-center justify-between border-b border-white/5 bg-[#222] px-4 py-2\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <CropIcon className=\"h-4 w-4 text-[#E0FC00]\" />\r\n          <span className=\"text-xs font-semibold tracking-wider text-gray-400 uppercase\">\r\n            {data.label ?? \"Crop Image\"}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex flex-col gap-4 p-4\">\r\n        {/* Input Handle Visualization */}\r\n        <div className=\"relative\">\r\n          <div className=\"absolute top-1/2 -left-7 -translate-y-1/2\">\r\n            <Handle\r\n              type=\"target\"\r\n              position={Position.Left}\r\n              id=\"image\"\r\n              className={cn(\r\n                \"!relative !left-0 !h-3 !w-3 !border-2 !border-[#1A1A1A]\",\r\n                connections.length > 0 ? \"!bg-green-500\" : \"!bg-indigo-500\",\r\n              )}\r\n              isValidConnection={validateInput}\r\n              title=\"Input Image (Base64)\"\r\n            />\r\n            <span className=\"absolute top-1/2 left-4 -translate-y-1/2 text-[10px] whitespace-nowrap text-gray-500\">\r\n              Input Image\r\n            </span>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"rounded bg-white/5 p-3\">\r\n          <p className=\"mb-2 text-xs font-semibold text-gray-400\">\r\n            Crop Percentages\r\n          </p>\r\n          <div className=\"grid grid-cols-2 gap-2\">\r\n            <div className=\"flex flex-col gap-1\">\r\n              <label className=\"text-[10px] text-gray-500\">\r\n                X Position (%)\r\n              </label>\r\n              <input\r\n                type=\"number\"\r\n                className=\"rounded border border-white/10 bg-black/50 px-2 py-1 text-xs text-white outline-none focus:border-[#E0FC00]\"\r\n                value={cropParams.x}\r\n                onChange={(e) => handleParamChange(\"x\", e.target.value)}\r\n              />\r\n            </div>\r\n            <div className=\"flex flex-col gap-1\">\r\n              <label className=\"text-[10px] text-gray-500\">\r\n                Y Position (%)\r\n              </label>\r\n              <input\r\n                type=\"number\"\r\n                className=\"rounded border border-white/10 bg-black/50 px-2 py-1 text-xs text-white outline-none focus:border-[#E0FC00]\"\r\n                value={cropParams.y}\r\n                onChange={(e) => handleParamChange(\"y\", e.target.value)}\r\n              />\r\n            </div>\r\n            <div className=\"flex flex-col gap-1\">\r\n              <label className=\"text-[10px] text-gray-500\">Width (%)</label>\r\n              <input\r\n                type=\"number\"\r\n                className=\"rounded border border-white/10 bg-black/50 px-2 py-1 text-xs text-white outline-none focus:border-[#E0FC00]\"\r\n                value={cropParams.width}\r\n                onChange={(e) => handleParamChange(\"width\", e.target.value)}\r\n              />\r\n            </div>\r\n            <div className=\"flex flex-col gap-1\">\r\n              <label className=\"text-[10px] text-gray-500\">Height (%)</label>\r\n              <input\r\n                type=\"number\"\r\n                className=\"rounded border border-white/10 bg-black/50 px-2 py-1 text-xs text-white outline-none focus:border-[#E0FC00]\"\r\n                value={cropParams.height}\r\n                onChange={(e) => handleParamChange(\"height\", e.target.value)}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <button\r\n          onClick={handleCrop}\r\n          disabled={isProcessing}\r\n          className={cn(\r\n            \"w-full rounded py-2 text-xs font-bold tracking-wider uppercase transition-colors\",\r\n            isProcessing\r\n              ? \"cursor-not-allowed bg-gray-700 text-gray-400\"\r\n              : \"bg-[#E0FC00] text-black hover:bg-[#cbe600]\",\r\n          )}\r\n        >\r\n          {isProcessing ? \"Cropping...\" : \"Crop Image\"}\r\n        </button>\r\n\r\n        {/* Result Preview */}\r\n        {data.imageUrl && (\r\n          <div className=\"flex flex-col gap-2\">\r\n            <span className=\"text-[10px] font-bold text-gray-500 uppercase\">\r\n              Result\r\n            </span>\r\n            <div className=\"relative aspect-video w-full overflow-hidden rounded border border-white/10 bg-black/50\">\r\n              {/* eslint-disable-next-line @next/next/no-img-element */}\r\n              <img\r\n                src={data.imageUrl}\r\n                alt=\"Cropped\"\r\n                className=\"h-full w-full object-contain\"\r\n              />\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Output Handle */}\r\n      <div className=\"relative flex h-10 items-center justify-end border-t border-white/5 bg-[#222] px-4\">\r\n        <span className=\"mr-2 text-xs text-gray-500\">image</span>\r\n        <Handle\r\n          type=\"source\"\r\n          position={Position.Right}\r\n          id=\"image\"\r\n          className=\"!h-3 !w-3 !border-2 !border-[#1A1A1A] !bg-[#E0FC00]\"\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\91895\\Desktop\\projects\\weavy-clone\\src\\components\\workflow\\nodes\\ExtractVideoFrameNode.tsx","messages":[{"ruleId":"@typescript-eslint/no-unnecessary-type-assertion","severity":2,"message":"This assertion is unnecessary since it does not change the type of the expression.","line":58,"column":19,"nodeType":"TSAsExpression","messageId":"unnecessaryAssertion","endLine":58,"endColumn":74,"fix":{"range":[1790,1829],"text":""}}],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":209,"column":15,"nodeType":"JSXOpeningElement","endLine":213,"endColumn":17,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport {\r\n  Handle,\r\n  Position,\r\n  useReactFlow,\r\n  useHandleConnections,\r\n} from \"@xyflow/react\";\r\nimport React, { useState } from \"react\";\r\nimport type { Node, NodeProps, Connection, Edge } from \"@xyflow/react\";\r\nimport { Smartphone } from \"lucide-react\";\r\nimport { cn } from \"~/lib/utils\";\r\nimport { useFlowStore } from \"~/store/flowStore\";\r\nimport { toast } from \"sonner\";\r\n\r\n// Define the data type for our node\r\ntype ExtractVideoFrameNodeData = {\r\n  label?: string;\r\n  imageUrl?: string; // The output extracted frame (Base64)\r\n};\r\n\r\ntype MyNode = Node<ExtractVideoFrameNodeData>;\r\n\r\nexport function ExtractVideoFrameNode({\r\n  data,\r\n  selected,\r\n  id,\r\n}: NodeProps<MyNode>) {\r\n  const { updateNodeData, nodeData } = useFlowStore();\r\n  const { getEdges, getNodes } = useReactFlow();\r\n\r\n  // Timestamp input (seconds)\r\n  const [timestamp, setTimestamp] = useState<number>(0);\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n\r\n  // Input connection tracking\r\n  const connections = useHandleConnections({ type: \"target\", id: \"video\" });\r\n\r\n  // Helper to get input video URL from connection\r\n  const getInputVideo = () => {\r\n    const edges = getEdges();\r\n    const nodes = getNodes();\r\n\r\n    // Find edge connected to our 'video' handle\r\n    const edge = edges.find(\r\n      (e) => e.target === id && e.targetHandle === \"video\",\r\n    );\r\n    if (!edge) return null;\r\n\r\n    // Try store first (live data)\r\n    if (nodeData[edge.source]) {\r\n      const sourceData = nodeData[edge.source] as Record<string, unknown>;\r\n      return (sourceData.mediaUrl ?? sourceData.video) as string | undefined; // Support conventions\r\n    }\r\n\r\n    // Fallback to node data\r\n    const sourceNode = nodes.find((n) => n.id === edge.source);\r\n    const sData = sourceNode?.data as Record<string, unknown> | undefined;\r\n    return (sData?.mediaUrl ?? sData?.video) as string | undefined;\r\n  };\r\n\r\n  const validateInput = (connection: Connection | Edge) => {\r\n    // connection.sourceHandle is the ID of the handle on the source node\r\n    const sourceHandleId = connection.sourceHandle;\r\n\r\n    // Only allow connection if the source handle is explicitly a video output\r\n    if (sourceHandleId === \"video\") return true;\r\n    return false;\r\n  };\r\n\r\n  const handleExtract = async () => {\r\n    const inputVideo = getInputVideo();\r\n\r\n    if (!inputVideo || typeof inputVideo !== \"string\") {\r\n      toast.error(\"No input video detected\", {\r\n        description:\r\n          \"Please connect a video output (like Upload Video) to this node.\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (!inputVideo.startsWith(\"data:video/\") && !inputVideo.startsWith(\"data:application/octet-stream\")) {\r\n       // Note: Some browsers might read video as octet-stream. \r\n       // Sticking to strict check if possible, but alerting user.\r\n       if(!inputVideo.startsWith(\"data:\")){\r\n            toast.error(\"Invalid Input Format\", {\r\n                description: \"The connected node must provide a Base64 Data URL.\"\r\n            });\r\n            return;\r\n       }\r\n    }\r\n\r\n    // Timestamp validation\r\n    if (timestamp < 0) {\r\n        toast.error(\"Invalid Timestamp\", {\r\n            description: \"Timestamp must be a non-negative number.\"\r\n        });\r\n        return;\r\n    }\r\n\r\n    setIsProcessing(true);\r\n    try {\r\n      const { extractVideoFrame } = await import(\"~/app/actions\");\r\n\r\n      toast.promise(extractVideoFrame(inputVideo, timestamp), {\r\n        loading: \"Extracting frame...\",\r\n        success: (result) => {\r\n          // Update local data and global store with result\r\n          updateNodeData(id, { imageUrl: result.url });\r\n          return \"Frame Extracted Successfully\";\r\n        },\r\n        error: (err) => {\r\n          console.error(\"Extraction error\", err);\r\n          return \"Extraction Failed\";\r\n        },\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Action import failed\", error);\r\n      toast.error(\"Failed to start extraction process\");\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={cn(\r\n        \"group relative flex w-80 flex-col rounded-xl border-2 bg-[#1A1A1A] text-white shadow-2xl transition-all\",\r\n        selected\r\n          ? \"border-[#E0FC00] shadow-[#E0FC00]/20\"\r\n          : \"border-white/10 hover:border-white/20\",\r\n      )}\r\n    >\r\n      {/* Header */}\r\n      <div className=\"flex h-10 items-center justify-between border-b border-white/5 bg-[#222] px-4 py-2\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <Smartphone className=\"h-4 w-4 text-[#E0FC00]\" />\r\n          <span className=\"text-xs font-semibold tracking-wider text-gray-400 uppercase\">\r\n            {data.label ?? \"Extract Frame\"}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex flex-col gap-4 p-4\">\r\n        {/* Input Handle Visualization */}\r\n        <div className=\"relative\">\r\n          <div className=\"absolute top-1/2 -left-7 -translate-y-1/2\">\r\n            <Handle\r\n              type=\"target\"\r\n              position={Position.Left}\r\n              id=\"video\"\r\n              className={cn(\r\n                \"!relative !left-0 !h-3 !w-3 !border-2 !border-[#1A1A1A]\",\r\n                connections.length > 0 ? \"!bg-green-500\" : \"!bg-indigo-500\",\r\n              )}\r\n              isValidConnection={validateInput}\r\n              title=\"Input Video (Base64)\"\r\n            />\r\n            <span className=\"absolute top-1/2 left-4 -translate-y-1/2 text-[10px] whitespace-nowrap text-gray-500\">\r\n              Input Video\r\n            </span>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"rounded bg-white/5 p-3\">\r\n          <p className=\"mb-2 text-xs font-semibold text-gray-400\">\r\n            Extraction Settings\r\n          </p>\r\n          <div className=\"flex flex-col gap-1\">\r\n            <label className=\"text-[10px] text-gray-500\">\r\n              Timestamp (Seconds)\r\n            </label>\r\n            <input\r\n              type=\"number\"\r\n              min=\"0\"\r\n              step=\"0.1\"\r\n              className=\"rounded border border-white/10 bg-black/50 px-2 py-1 text-xs text-white outline-none focus:border-[#E0FC00]\"\r\n              value={timestamp}\r\n              onChange={(e) => {\r\n                  const val = parseFloat(e.target.value);\r\n                  if(!isNaN(val)) setTimestamp(val);\r\n                  else setTimestamp(0); // or handle empty string better\r\n              }}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <button\r\n          onClick={handleExtract}\r\n          disabled={isProcessing}\r\n          className={cn(\r\n            \"w-full rounded py-2 text-xs font-bold tracking-wider uppercase transition-colors\",\r\n            isProcessing\r\n              ? \"cursor-not-allowed bg-gray-700 text-gray-400\"\r\n              : \"bg-[#E0FC00] text-black hover:bg-[#cbe600]\",\r\n          )}\r\n        >\r\n          {isProcessing ? \"Extracting...\" : \"Extract Frame\"}\r\n        </button>\r\n\r\n        {/* Result Preview */}\r\n        {data.imageUrl && (\r\n          <div className=\"flex flex-col gap-2\">\r\n            <span className=\"text-[10px] font-bold text-gray-500 uppercase\">\r\n              Result\r\n            </span>\r\n            <div className=\"relative aspect-video w-full overflow-hidden rounded border border-white/10 bg-black/50\">\r\n              {/* eslint-disable-next-line @next/next/no-img-element */}\r\n              <img\r\n                src={data.imageUrl}\r\n                alt=\"Extracted\"\r\n                className=\"h-full w-full object-contain\"\r\n              />\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Output Handle */}\r\n      <div className=\"relative flex h-10 items-center justify-end border-t border-white/5 bg-[#222] px-4\">\r\n        <span className=\"mr-2 text-xs text-gray-500\">image</span>\r\n        <Handle\r\n          type=\"source\"\r\n          position={Position.Right}\r\n          id=\"image\"\r\n          className=\"!h-3 !w-3 !border-2 !border-[#1A1A1A] !bg-[#E0FC00]\"\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\91895\\Desktop\\projects\\weavy-clone\\src\\components\\workflow\\nodes\\RunLLMNode.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\91895\\Desktop\\projects\\weavy-clone\\src\\components\\workflow\\nodes\\TextNode.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\91895\\Desktop\\projects\\weavy-clone\\src\\components\\workflow\\nodes\\UploadImageNode.tsx","messages":[],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":119,"column":13,"nodeType":"JSXOpeningElement","endLine":123,"endColumn":15,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\91895\\Desktop\\projects\\weavy-clone\\src\\components\\workflow\\nodes\\UploadVideoNode.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]